# pythorch tools
import torch
# Import function to make predictions on images
from predictions import pred_and_plot_image

class Cocobolo():
    
    def __init__(self) -> None:
        print("================")
        # Setup custom image path
        self.IMAGE = "/home/thechancher/ViT/images/image.jpg"

        # Brazil DB
        # self.CLASS_NAMES_raw = {"1":"1-Aspidosperma polyneuron", "2":"2-Araucaria angustifolia", "3":"3-Tabebuia sp.", "4":"4-Cordia goeldiana", "5":"5-Cordia sp.", "6":"6-Hura crepitans", "7":"7-Acrocarpus fraxinifolius", "8":"8-Hymenaea sp.", "9":"9-Peltogyne sp.", "10":"10-Hymenolobium petraeum", "11":"11-Myroxylon balsamum", "12":"12-Dipteryx sp.", "13":"13-Machaerium sp.", "14":"14-Bowdichia sp.", "15":"15-Mimosa scabrella", "16":"16-Cedrelinga catenaeformis", "17":"17-Goupia glabra", "18":"18-Ocotea porosa", "19":"19-Mezilaurus itauba", "20":"20-Laurus nobilis", "21":"21-Bertholethia excelsa", "22":"22-Cariniana estrellensis", "23":"23-Couratari sp.", "24":"24-Carapa guianensis", "25":"25-Cedrela fissilis", "26":"26-Melia azedarach", "27":"27-Swietenia macrophylla", "28":"28-Brosimum paraense", "29":"29-Bagassa guianensis", "30":"30-Virola surinamensis", "31":"31-Eucalyptus sp.", "32":"32-Pinus sp.", "33":"33-Podocarpus lambertii", "35":"35-Balfourodendron riedelianum", "36":"36-Euxylophora paraensis", "37":"37-Micropholis venulosa", "38":"38-Pouteria pachycarpa", "39":"39-Manilkara huberi", "40":"40-Erisma uncinatum", "41":"41-Vochysia sp."}
        # self.CLASS_NAMES_raw = ["0", "1-Aspidosperma polyneuron", "2-Araucaria angustifolia", "3-Tabebuia sp.", "4-Cordia goeldiana", "5-Cordia sp.", "6-Hura crepitans", "7-Acrocarpus fraxinifolius", "8-Hymenaea sp.", "9-Peltogyne sp.", "10-Hymenolobium petraeum", "11-Myroxylon balsamum", "12-Dipteryx sp.", "13-Machaerium sp.", "14-Bowdichia sp.", "15-Mimosa scabrella", "16-Cedrelinga catenaeformis", "17-Goupia glabra", "18-Ocotea porosa", "19-Mezilaurus itauba", "20-Laurus nobilis", "21-Bertholethia excelsa", "22-Cariniana estrellensis", "23-Couratari sp.", "24-Carapa guianensis", "25-Cedrela fissilis", "26-Melia azedarach", "27-Swietenia macrophylla", "28-Brosimum paraense", "29-Bagassa guianensis", "30-Virola surinamensis", "31-Eucalyptus sp.", "32-Pinus sp.", "33-Podocarpus lambertii", "35-Balfourodendron riedelianum", "36-Euxylophora paraensis", "37-Micropholis venulosa", "38-Pouteria pachycarpa", "39-Manilkara huberi", "40-Erisma uncinatum", "41-Vochysia sp."]
        # self.CLASS_NAMES = ['1', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '2', '3', '4', '5', '6', '7', '8', '9']
        # self.test_dir = "/home/thechancher/ViT/images/0258.JPG" # must be: class 2 for Brazil db
        # self.MODEL = torch.load("/home/thechancher/ViT/models/model-bz.pth")
        
        # Costa Rica DB
        self.CLASS_NAMES_raw = {"10":"10-Spondias mombin [Jobo]","100":"100-Brosimum lactescens [Ojoche blanco, (Ojoche, Ojochillo)]","101":"101-Garcinia madruno [Madruno, Manzana amarilla, (Jorco, Limón de montaña, Madroño)]","102":"102-Dialium guianense [Tamarindo de montaña, (Tamarindo)]","104":"104-Calophyllum brasiliense [Cedro María, María ]","106":"106-Stryphnodendron  microstachyum [Vainillo]","107":"107-Simarouba amara [Aceituno]","113":"113-Hampea appendiculata [Burío, (Algodoncillo, Burío blanco)]","114":"114-Vochysia guatemalensis [Mayo, Cebo, Chancho blanco, (Mayo blanco, Chancho)]","115":"115-Clethra costaricensis [Nance macho]","116":"116-Pourouma bicolor [Chumico]","117":"117-Ilex skutchii [Arenillo, Campano, (Campano blanco)]","118":"118-Inga oerstesiana [Cuajiniquil peludo]","119":"119-Myrsine  pellucidopunctata [Ratón, Ratoncillo]","120":"120-Nectandra membranacea [Aguacatillo, (Quizarrá)]","121":"121-Inga chocoensis [Guabo]","122":"122-Lonchocarpus macrophyllum [Chaperno]","125":"125-Pentaclethra macroloba [Gavilán]","126":"126-Prioria copaifera [Cativo]","127":"127-Chloroleucon sp [Casha]","13":"13-Luehea speciosa [Guácimo molenillo, (Guácimo macho, Guácimo)]","131":"131-Prioria sp. nov [Cativo]","135":"135-Tachigali costaricensis [Tostado]","136":"136-Magnolia gloriensis [Anonillo]","137":"137-Cespedesia spathulata [Tabacón, (Cola de pavo)]","138":"138-Ocotea floribunda [Aguacatillo]","139":"139-Bourreria costaricensis [-]","140":"140-Staphylea occidentalis [Sauco, (Sanlorenzo)]","142":"142-Apeiba membranacea [Peine de mico, Botija]","143":"143-Maranthes panamensis [Pejivallito, (Pejibaye)]","144":"144-Drypetes brownii [Piedrilla]","147":"147-Trichospermum galeottii [Guácimo blanco, (Capulín, Jucó blanco)]","148":"148-Parathesis trichogyne [-]","17":"17-Pochota  fendleri [Pochote, Cedro pochote]","18":"18-Samanea saman [Cenízaro, Genízaro]","2":"2-Cedrela odorata [Cedro amargo]","20":"20-Pachira aquatica [Poponjoche, (Cacao cimarrón, Lirio de agua)]","21":"21-Schizolobium paraibuna [Gallinazo]","23":"23-Tabebuia rosea [Roble de Sabana]","25":"25-Sapium glandulosum [Yos]","27":"27-Brosimum alicastrum [Ojoche, Ramón]","28":"28-Bursera simaruba [Indio desnudo, Jiñocuabe, (Caraña)]","29":"29-Pouteria reticulata [Sapotillo]","3":"3-Cordia alliodora [Laurel]","30":"30-Cassia grandis [Carao, (Sandal)]","31":"31-Trichilia pleeana [-]","43":"43-Brosimum utile [Vaco, Lechoso, (Mastate)]","44":"44-Calophyllum mesoamericanum [Cedro María, María ]","45":"45-Carapa guianensis [Cedro bateo, Cedro macho, Caobilla, (Bateo)]","46":"46-Caryocar costaricense [Ajo, Ajillo]","48":"48-Couratari guianensis [Cachimbo hediondo, Copo hediondo, (Campano Blanco)]","49":"49-Dendropanax arboreus [Fosforillo]","5":"5-Enterolobium cyclocarpum [Guanacaste, (Kurú)]","55":"55-Hieronyma alchorneoides [Pilón, Zapatero, (Sangre de toro)]","57":"57-Jacaranda copaia [Gallinazo, (Jacaranda)]","58":"58-Lacmellea panamensis [Leche de vaca, Lagarto negro]","63":"63-Peltogyne purpurea [Nazareno]","65":"65-Poulsenia armata [Mastate, (Calugo, Chilamate espina)]","7":"7-Diphysa americana [Guachepelín]","70":"70-Pterocarpus sp [Sangrillo]","74":"74-Symphonia globulifera [Cerillo, (Botoncillo)]","75":"75-Tapirira guianensis [Manteco, Cedrillo]","77":"77-Terminalia bucidoides [Escobo, Guayabo de charco, (Roble de charco)]","80":"80-Virola koschnyi [Fruta dorada, Fruta dorada real, (Fruta)]","81":"81-Virola sebifera [-]","82":"82-Vitex cooperi [Manú Platano, Cuajada]","83":"83-Vochysia ferruginea [Botarrama, Mayo colorado, (Mayo)]","84":"84-Vochysia gentryi [Ira de agua, (Mayo)]","85":"85-Zanthoxylum ekmanii [Largarto amarillo, Lagarto, (Lagartillo)]","88":"88-Brosimum costaricanum [Ojoche, (Ojoche macho)]","89":"89-Hymenaea osanigraseminae [Guapinol]","9":"9-Hymenaea courbaril [Guapinol]","93":"93-Astronium graveolens [Ron-ron, (Comenegro)]","94":"94-Pseudolmedia spuria [Ojochillo, Ojochillo colorado, (Guapinolillo, Casanegro)]","99":"99-Pouteria filipes [Sapotillo]"}
        # self.CLASS_NAMES_raw = ["0", "2-Cedrela odorata <Cedro amargo>", "3-Cordia alliodora <Laurel>", "5-Enterolobium cyclocarpum <Guanacaste, (Kurú)>", "7-Diphysa americana <Guachepelín>", "9-Hymenaea courbaril <Guapinol>", "10-Spondias mombin <Jobo>", "13-Luehea speciosa <Guácimo molenillo, (Guácimo macho, Guácimo)>", "17-Pochota  fendleri <Pochote, Cedro pochote>", "18-Samanea saman <Cenízaro, Genízaro>", "20-Pachira aquatica <Poponjoche, (Cacao cimarrón, Lirio de agua)>", "21-Schizolobium paraibuna <Gallinazo>", "23-Tabebuia rosea <Roble de Sabana>", "25-Sapium glandulosum <Yos>", "27-Brosimum alicastrum <Ojoche, Ramón>", "28-Bursera simaruba <Indio desnudo, Jiñocuabe, (Caraña)>", "29-Pouteria reticulata <Sapotillo>", "30-Cassia grandis <Carao, (Sandal)>", "31-Trichilia pleeana <->", "43-Brosimum utile <Vaco, Lechoso, (Mastate)>", "44-Calophyllum mesoamericanum <Cedro María, María >", "45-Carapa guianensis <Cedro bateo, Cedro macho, Caobilla, (Bateo)>", "46-Caryocar costaricense <Ajo, Ajillo>", "48-Couratari guianensis <Cachimbo hediondo, Copo hediondo, (Campano Blanco)>", "49-Dendropanax arboreus <Fosforillo>", "55-Hieronyma alchorneoides <Pilón, Zapatero, (Sangre de toro)>", "57-Jacaranda copaia <Gallinazo, (Jacaranda)>", "58-Lacmellea panamensis <Leche de vaca, Lagarto negro>", "63-Peltogyne purpurea <Nazareno>", "65-Poulsenia armata <Mastate, (Calugo, Chilamate espina)>", "70-Pterocarpus sp <Sangrillo>", "74-Symphonia globulifera <Cerillo, (Botoncillo)>", "75-Tapirira guianensis <Manteco, Cedrillo>", "77-Terminalia bucidoides <Escobo, Guayabo de charco, (Roble de charco)>", "80-Virola koschnyi <Fruta dorada, Fruta dorada real, (Fruta)>", "81-Virola sebifera <->", "82-Vitex cooperi <Manú Platano, Cuajada>", "83-Vochysia ferruginea <Botarrama, Mayo colorado, (Mayo)>", "84-Vochysia gentryi <Ira de agua, (Mayo)>", "85-Zanthoxylum ekmanii <Largarto amarillo, Lagarto, (Lagartillo)>", "88-Brosimum costaricanum <Ojoche, (Ojoche macho)>", "89-Hymenaea osanigraseminae <Guapinol>", "93-Astronium graveolens <Ron-ron, (Comenegro)>", "94-Pseudolmedia spuria <Ojochillo, Ojochillo colorado, (Guapinolillo, Casanegro)>", "99-Pouteria filipes <Sapotillo>", "100-Brosimum lactescens <Ojoche blanco, (Ojoche, Ojochillo)>", "101-Garcinia madruno <Madruno, Manzana amarilla, (Jorco, Limón de montaña, Madroño)>", "102-Dialium guianense <Tamarindo de montaña, (Tamarindo)>", "104-Calophyllum brasiliense <Cedro María, María >", "106-Stryphnodendron  microstachyum <Vainillo>", "107-Simarouba amara <Aceituno>", "113-Hampea appendiculata <Burío, (Algodoncillo, Burío blanco)>", "114-Vochysia guatemalensis <Mayo, Cebo, Chancho blanco, (Mayo blanco, Chancho)>", "115-Clethra costaricensis <Nance macho>", "116-Pourouma bicolor <Chumico>", "117-Ilex skutchii <Arenillo, Campano, (Campano blanco)>", "118-Inga oerstesiana <Cuajiniquil peludo>", "119-Myrsine  pellucidopunctata <Ratón, Ratoncillo>", "120-Nectandra membranacea <Aguacatillo, (Quizarrá)>", "121-Inga chocoensis <Guabo>", "122-Lonchocarpus macrophyllum <Chaperno>", "125-Pentaclethra macroloba <Gavilán>", "126-Prioria copaifera <Cativo>", "127-Chloroleucon sp <Casha>", "131-Prioria sp. nov <Cativo>", "135-Tachigali costaricensis <Tostado>", "136-Magnolia gloriensis <Anonillo>", "137-Cespedesia spathulata <Tabacón, (Cola de pavo)>", "138-Ocotea floribunda <Aguacatillo>", "139-Bourreria costaricensis <->", "140-Staphylea occidentalis <Sauco, (Sanlorenzo)>", "142-Apeiba membranacea <Peine de mico, Botija>", "143-Maranthes panamensis <Pejivallito, (Pejibaye)>", "144-Drypetes brownii <Piedrilla>", "147-Trichospermum galeottii <Guácimo blanco, (Capulín, Jucó blanco)>", "148-Parathesis trichogyne <->"]
        self.CLASS_NAMES = ['10', '100', '101', '102', '104', '106', '107', '113', '114', '115', '116', '117', '118', '119', '120', '121', '122', '125', '126', '127', '13', '131', '135', '136', '137', '138', '139', '140', '142', '143', '144', '147', '148', '17', '18', '2', '20', '21', '23', '25', '27', '28', '29', '3', '30', '31', '43', '44', '45', '46', '48', '49', '5', '55', '57', '58', '63', '65', '7', '70', '74', '75', '77', '80', '81', '82', '83', '84', '85', '88', '89', '9', '93', '94', '99']
        self.test_dir = "/home/thechancher/ViT/images/3656.jpg" # must be: class 17 for CR db
        self.MODEL = torch.load("/home/thechancher/ViT/models/model-cr.pth", map_location=torch.device('cpu'))

        self.MODEL.eval()
        
    def getClassNames(self):
        return self.CLASS_NAMES_raw
        
    def predict_test(self):
        # Predict on custom image
        return pred_and_plot_image(model=self.MODEL,
                            image_path=self.test_dir,
                            class_names=self.CLASS_NAMES,
                            class_labels=self.CLASS_NAMES_raw)
    
    def predict(self):
        # Predict on custom image
        return pred_and_plot_image(model=self.MODEL,
                            image_path=self.IMAGE,
                            class_names=self.CLASS_NAMES,
                            class_labels=self.CLASS_NAMES_raw)